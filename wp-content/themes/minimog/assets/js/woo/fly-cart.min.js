!function(i){"use strict";var e=i("body"),r=i("#popup-fly-cart"),t="popup-fly-cart-opened",o=window.minimog.Helpers;function a(t){var e;"undefined"!=typeof wc_add_to_cart_params&&(t.preventDefault(),e=i(this),i.ajax({type:"POST",url:$minimogWoo.wc_ajax_url.toString().replace("%%endpoint%%","remove_from_cart"),data:{cart_item_key:e.data("cart_item_key")},dataType:"json",beforeSend:function(){u()},success:function(t){t&&t.fragments?(i(document.body).trigger("removed_from_cart",[t.fragments,t.cart_hash,e]),f()):window.location=e.attr("href")},error:function(){window.location=e.attr("href")}}))}function n(){var t=i(this).find("button[type=submit]"),e=i(this).find('textarea[name="order_comments"]').val();return i.ajax({type:"POST",url:$minimog.ajaxurl,data:{action:"minimog_save_order_notes",order_notes:e},dataType:"json",success:function(t){t.data&&t.data.fragments&&i.each(t.data.fragments,function(t,e){i(t).replaceWith(e)}),i('textarea[name="order_comments"]').val(e)},beforeSend:function(){o.setElementHandling(t)},complete:function(){o.unsetElementHandling(t),l()}}),!1}function c(){o.setBodyOverflow(),e.addClass(t),i.fn.perfectScrollbar&&!o.isHandheld()&&setTimeout(function(){r.find(".fly-cart-wrap").perfectScrollbar()},100),o.handleLazyImages(r),m(),r.hasClass("opened")||i(document.body).trigger("minimog_fly_cart_first_open",[r]),r.addClass("opened")}function d(){o.unsetBodyOverflow(),e.removeClass(t)}function s(){return!!e.hasClass(t)}function l(){r.find(".fly-cart-addon-modal").removeClass("open"),r.removeClass("modal-open")}function m(){var t=r.offset().top,e=r.find(".fly-cart-header"),a=r.find(".fly-cart-body"),n=r.find(".fly-cart-footer"),e=window.innerHeight-e.outerHeight()-n.outerHeight()-20-t,e=Math.max(e,400);a.outerHeight(e),i.fn.perfectScrollbar&&!o.isHandheld()&&a.perfectScrollbar({wheelPropagation:!0})}function u(){r.find(".fly-cart-messages").slideUp(300,function(){r.find(".fly-cart-messages").empty()}),r.removeClass("loaded").addClass("loading")}function f(){r.removeClass("loading").addClass("loaded")}function p(){var t={},e=(i(this).closest(".woocommerce-shipping-methods").find("select.shipping_method, :input[name^=shipping_method][type=radio]:checked, :input[name^=shipping_method][type=hidden]").each(function(){t[i(this).data("index")]=i(this).val()}),{security:$minimog.nonce,shipping_method:t,action:"minimog_update_shipping_method"});i.ajax({type:"POST",url:$minimog.ajaxurl,data:e,dataType:"json",success:function(t){t.data&&t.data.fragments&&i.each(t.data.fragments,function(t,e){i(t).replaceWith(e)})},beforeSend:function(){s()?u():o.setBodyHandling()},complete:function(){s()?f():o.setBodyCompleted(),i(document.body).trigger("updated_shipping_method")}})}function g(t){t.preventDefault(),l(),u();t=i(t.currentTarget);i("<input />").attr("type","hidden").attr("name","action").attr("value","minimog_calculate_shipping").appendTo(t),i.ajax({type:t.attr("method"),url:$minimog.ajaxurl,data:t.serialize(),dataType:"json",success:function(t){t.data.fragments&&i.each(t.data.fragments,function(t,e){i(t).empty(),""!==e&&(e=i(i.parseHTML(e)),i(t).html(e.html()))})},complete:function(){f()}})}function h(){var t=i(".cart-data-info").first();0<t.length&&(t.data("value").count<=0?e.addClass("cart-is-empty"):e.removeClass("cart-is-empty")),i(".cart-goal-percent").each(function(){var t=i(this).closest(".cart-goal"),e=t.find(".cart-goal-progress .progress-bar"),a=parseFloat(i(this).val());setTimeout(function(){e.css({width:a+"%"}),a<100?t.removeClass("cart-goal-done shakeY"):t.addClass("cart-goal-done shakeY")},300)})}function _(){var o,t=i(".cart-data-info").first();t.length<=0||!i.fn.MinimogCountdownTimer||(o=t.data("value"),i(".cart-countdown-timer").each(function(){var t=i(this),e=t.find(".timer"),a=t.data("countdown"),n=Date.now(),n={startTime:n,endTime:n+60*a.length*1e3,addZeroPrefix:!0,formatter:a.formatter,loop:a.loop,callback:()=>{t.find(".cart-countdown-message").text(a.expired_message)}};if(o.count<=0)return e.MinimogCountdownTimer(n),e.MinimogCountdownTimer("clear"),!0;e.MinimogCountdownTimer(n)}))}i(document).ready(function(){var t;i(document.body).on("click",".mini-cart__button",function(t){0<r.length&&(t.preventDefault(),c())}),e.on("added_to_cart",function(t,e,a,n){var o;void 0!==n&&(0<(o=n.closest(".modal-quick-view-popup")).length&&i.fn.MinimogModal&&o.MinimogModal("close"),0<(o=n.closest("#woosw_wishlist")).length&&(o.removeClass("woosw-show"),i(document.body).trigger("woosw_wishlist_hide")),0<r.length&&c())}),i("#btn-close-fly-cart").on("click",function(t){t.preventDefault(),d()}),r.on("click",function(t){t.target===this&&d()}),i(document).on("click",".fly-cart-addon-modal-toggle",function(t){t.preventDefault();var t=i(this).data("target"),e=i(t);0<e.length&&(t=e.data("minimog-template"),!e.hasClass("template-loaded")&&t?i.ajax({url:o.getAjaxUrl("template_lazyload"),type:"GET",data:{template:t,context:"wc_cart"},dataType:"json",cache:!1,success:function(t){t.success&&(e.html(t.data.template),e.hasClass("modal-shipping-calculator")&&i(document.body).trigger("country_to_state_changed"),r.addClass("modal-open"),e.addClass("open"),e.addClass("template-loaded"))},beforeSend:function(){u()},complete:function(){f()}}):(r.addClass("modal-open"),e.addClass("open")))}),r.on("click",".btn-close-fly-cart-modal",function(t){t.preventDefault(),l()}),r.on("click",".js-remove-from-cart",a),r.on("change",".qty",function(){var o=i(this);void 0!==t&&clearTimeout(t),t=setTimeout(function(){var e,a,t=o.attr("name"),n=o.val();t={action:"minimog_update_product_quantity",cart_item_key:e=t,cart_item_qty:a=n,security:$minimog.nonce},i.ajax({url:$minimog.ajaxurl,type:"POST",cache:!1,dataType:"json",data:t,success:function(t){i(document.body).trigger("wc_fragment_refresh"),i(document.body).trigger("minimog_update_qty",[e,a])},beforeSend:function(){u()},complete:function(){}})},500)}),r.on("submit",".form-fly-cart-order-notes",n),i(document).on("change","select.shipping_method, :input[name^=shipping_method]",p),i(document).on("submit","form.fly-cart-shipping-calculator",g)}),i(document.body).on("wc_fragments_loaded wc_fragments_refreshed",function(){f(),h(),_(),e.hasClass(t)&&(o.handleLazyImages(r),m())}),i(document.body).on("removed_coupon applied_coupon",h),i(window).on("load",_)}(jQuery);