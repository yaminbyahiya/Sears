!function(r,d){var l={controlSpace:18,maxWidth:"auto",width:!1,resize:!0,titles:{before:"",after:""},layout:{container:'<div class="b-diff"></div>',item:'<div class="b-diff__item"></div>',control:'<div class="b-diff__control"><div class="b-diff__line"></div><div class="b-diff__arrow b-diff__arrow_left"></div><div class="b-diff__arrow b-diff__arrow_right"></div></div>',title:'<div class="b-diff__title"></div>'}};d.fn.simpleImageDiff=function(t){d.extend(l,t||{}),this.each(function(){var o,s;o=d(this),(s={current:!1,currentParent:!1,loaded:0,dimensions:!1,currentImageDim:{},controlPosition:0,clipAreaRatio:!1,$clipedImage:!1,$control:!1,init:function(){var e=o.find("img").slice(0,2),c=d("body");l.maxWidth=0<o.attr("data-maxWidth")?o.attr("data-maxWidth"):l.maxWidth,l.resize=o.attr("data-resize")?parseInt(o.attr("data-resize")):l.resize,s.current=d(l.layout.container),s.currentParent=o.closest(".eac-images-comparison"),s.current.on("prebuild",function(){s.dimensions=s.getImageRealSize(e.first().get(0)),l.width||(l.width=s.current.width()),s.current.insertBefore(o),s.current.css({height:l.width/s.dimensions.width*s.dimensions.height})}),s.current.on("loaded",function(){var t,a,n={};function i(t){s.stopAnimation(s.$control),s.stopAnimation(s.$clipedImage);var e=t.pageY||t.originalEvent.touches[0].pageY,n=t.pageX||t.originalEvent.touches[0].pageX,o=!0,r=0;c.on("mousemove.diff touchmove.diff",function(t){var i=t.pageX||t.originalEvent.touches[0].pageX,t=t.pageY||t.originalEvent.touches[0].pageY;if(Math.abs(t-e)>Math.abs(i-n)&&r<1)return!(o=!1);o&&(s.controlPosition=i-a.left,s.clipAreaRatio=s.controlPosition/s.currentImageDim.width,s.move(s.controlPosition),r+=1)})}n.before=e.first().attr("data-title")||l.titles.before,n.after=e.last().attr("data-title")||l.titles.after,e.each(function(t){var i=d(l.layout.item),e=d(l.layout.title);i.append(d(this)),n.before&&t<1&&(e.addClass("b-diff__title_before"),i.append(e.text(n.after))),n.after&&0<t&&(e.addClass("b-diff__title_after"),i.append(e.text(n.before))),s.current.append(i)}),s.$control=d(l.layout.control),s.$clipedImage=s.current.find(".b-diff__item:last"),s.current.append(s.$control),a=s.current.offset(),s.resizeItems(l.width),t=s.$control.width(),s.controlPosition=s.currentImageDim.width/2-t/2,s.clipAreaRatio=s.controlPosition/s.currentImageDim.width,s.move(s.controlPosition),o.remove(),l.resize&&d(r).resize(function(){s.stopAnimation(s.$control),s.stopAnimation(s.$clipedImage),s.resizeItems(),s.controlPosition=s.clipAreaRatio*s.currentImageDim.width,s.move(s.controlPosition),a=s.current.offset()}),s.current.on("click",function(t){t=t.pageX||t.originalEvent.touches[0].pageX;s.controlPosition=t-a.left,s.clipAreaRatio=s.controlPosition/s.currentImageDim.width,s.animateItems(s.controlPosition)}),s.current.on("mousedown.diff",function(t){if(1==t.which)return i(t),!1}),s.current.on("touchstart.diff",i),c.on("mouseup.diff touchend.diff mouseleave.diff touchleave.diff",function(){c.off("mousemove.diff touchmove.diff")}),e.on("dragstart",function(){return!1})}),e.each(function(){this.complete?(s.loaded+=1,1===s.loaded&&s.current.trigger("prebuild"),s.loaded==e.length&&s.current.trigger("loaded")):d(this).load(function(){s.loaded+=1,1===s.loaded&&s.current.trigger("prebuild"),s.loaded==e.length&&s.current.trigger("loaded")})})},getImageRealSize:function(t){return{width:t.naturalWidth,height:t.naturalHeight,ratio:t.naturalWidth/t.naturalHeight}},setClipArea:function(t){s.$clipedImage.css("clip","rect(0, "+t+"px,"+s.currentImageDim.height+"px, 0)")},moveControl:function(t){s.$control.css({left:t})},move:function(t){var i=s.$control.width();t<=0?t=0:t>=s.currentImageDim.width-i&&(t=s.currentImageDim.width-i),s.moveControl(t-l.controlSpace),s.setClipArea(t)},resizeItems:function(t){var t=t||s.current.width();s.dimensions.width<=t&&(t=s.dimensions.width),"auto"!=l.maxWidth&&(t=l.maxWidth<t?l.maxWidth:t),t=t/s.dimensions.width,s.currentImageDim.width=t*s.dimensions.width,s.currentImageDim.height=t*s.dimensions.height,s.current.find(".b-diff__item").css({width:s.currentImageDim.width,height:s.currentImageDim.height}),s.current.css("height",s.currentImageDim.height),s.$control.css("height",s.currentImageDim.height)},animateItems:function(t){s.$control.css({"-webkit-transition":"left .3s ease-in-out",transition:"left .3s ease-in-out"}),s.$clipedImage.css({"-webkit-transition":"all .3s ease-in-out",transition:"all .3s ease-in-out"}),s.move(t)},stopAnimation:function(t){t.css({"-webkit-transition":"",transition:""})}}).init()})}}(window,(document,jQuery));